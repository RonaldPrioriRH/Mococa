#include "report.ch"
#INCLUDE "rwmake.ch"
#INCLUDE "TopConn.ch"
#INCLUDE "Protheus.ch"                                                                             
/*/

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัอออออออออออออออออออออออหออออออออออออออออออัออออออออออออออออออออออออออออออออออออออออออออออออปฑฑ
ฑฑบPrograma  ณRGLT074   บ Autor ณ Pedro Tobaruela Ortiz บ Data da Criacao  ณ 28/07/2014                						บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯอออออออออออออออออออออออสออออออออออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบDescricao ณ Relatorio Ausencia de Analise                                                                      			บฑฑ
ฑฑบ          ณ 															                               						บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ                      																						บฑฑ
ฑฑบ			 ณ					                                                                                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบParametrosณ                                                                                         						บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบRetorno   ณ                                                      	                                                    บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUsuario   ณ                                                                                          					บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบSetor     ณ                                                                                         						บฑฑ
ฑฑฬออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบ            			          	ATUALIZACOES SOFRIDAS DESDE A CONSTRUAO INICIAL                   						บฑฑ
ฑฑฬออออออออออัออออออออออัออออออออออออออออออออออออออออออออออออออออออออออออออัออออออออออออออออออออออออออออออออออัอออออออออออออนฑฑ
ฑฑบAutor     ณ Data     ณ Motivo da Alteracao  				               ณUsuario(Filial+Matricula+Nome)    ณSetor        บฑฑ
ฑฑบฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤฤฤฤบฑฑ
ฑฑบ----------ณ----------ณ--------------------------------------------------ณ----------------------------------ณ-------------บฑฑ
ฑฑศออออออออออฯออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออฯออออออออออออออออออออออออออออออออออฯอออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
/*/

User function RGLT074()

Private _cFunc:=""
Private oReport
Private cPerg := "RGLT074"
Private oBreak                       
// Private oSecCC, oSecFunc, oSecEPI, oBreakF, oBreakEP
Private oSecANA

CriaSX1(cPerg)

//Chama a tela de parametros
If !Pergunte(cPerg,.T.)
	Return(Nil)
EndIf


//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณINICIO DO OBJETO TREPORT PARA O RELATORIOณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู

DEFINE REPORT oReport NAME "RGLT074" TITLE "AUSสNCIA DE ANมLISES DA FAIXA "+cvaltochar(mv_par01)+" ENTRE "+cvaltochar(mv_par02)+" E "+cvaltochar(mv_par03)+"." PARAMETER cPerg ACTION {|oReport| PrintReport(oReport)}

oReport:nFontBody	:= 09
oReport:cFontBody	:= "Courier New"  
oReport:nLineHeight	:= 50 // Define a altura da linha.
oReport:DisableOrientation()//Desabilita a escolha do tipo de orientacao da pagina retrato ou paisagem    
oReport:SetMsgPrint('Processando dados do Relat๓rio')
oReport:SetLandscape()
oReport:SetTotalInLine(.F.)

/*

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณSESSAO DO CENTRO DE CUSTOณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู

DEFINE SECTION oSecFunc OF oReport TITLE "Funcionario" TABLES "TRB01"  
DEFINE CELL NAME "cFunc"   	OF oSecCC ALIAS "TRB01"  BLOCK{|| Alltrim(TRB01->TNF_MAT)+" - "+Alltrim (TRB01->RA_NOME)} TITLE "Funcionario"

oSecFunc:SetColSpace( 1 )
oSecFunc:SetTotalInLine(.F.) 
oSecFunc:SetHeaderBreak(.T.)                                                   
oSecFunc:SetAutoSize(.T.)          
oSecFunc:SetHeaderPage(.T.) //Se imprime o tํtulo das colunas no inicio  
oSecFunc:SetCellBorder(5,2,,.T.)

*/


//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณSESSAO DE DADOS DOS APONTAMENTOS E EPIณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู

// DEFINE CELL NAME "ZZD_PREC01"  	OF oPRO ALIAS "TAB001" SIZE 12 PICTURE '@E 999,999.99' TITLE dDtTab		


DEFINE SECTION oSecANA OF oReport TITLE "Aus๊ncia de Anแlise" TABLES "TRB01"                                                        
DEFINE CELL NAME "nOrdem"     	OF oSecANA ALIAS "TRB01" SIZE 02 BLOCK{|| TRB01->ORDEM} TITLE " "
DEFINE CELL NAME "cRetiro"     	OF oSecANA ALIAS "TRB01" SIZE 11 BLOCK{|| TRB01->ZLD_RETIRO+"-"+TRB01->ZLD_RETILJ} TITLE " Retiro "
DEFINE CELL NAME "cNome"     	OF oSecANA ALIAS "TRB01" SIZE 32 BLOCK{|| TRB01->ZLD_DCRRET} 						TITLE " Nome "
DEFINE CELL NAME "cUltCol"     	OF oSecANA ALIAS "TRB01" SIZE 12 BLOCK{|| TRB01->ZLD_DTCOLE}   						TITLE " Ult. Col. "
DEFINE CELL NAME "cFretista"	OF oSecANA ALIAS "TRB01" SIZE 32 BLOCK{|| TRB01->ZLD_DCFRET} 						TITLE " Fretista "
DEFINE CELL NAME "cEqpto"     	OF oSecANA ALIAS "TRB01" SIZE 05 BLOCK{|| TRB01->ZL4_EQPTO} 						TITLE " Eqpto "
DEFINE CELL NAME "cLinha"     	OF oSecANA ALIAS "TRB01" SIZE 27 BLOCK{|| TRB01->ZLD_DESLIN} 						TITLE " Linha "

// oSecANA:Cell("cRetiro"):Disable()

//Totalizador dos EPI
// oBreakEP := TRBreak():New(oSecANA,oSecANA:Cell("cRetiro"),"Total Aus๊ncia")
// TRFunction():New(oSecANA:Cell("cCEPI"),NIL,"SUM",oBreakEP)

oSecANA:SetColSpace( 3 )
oSecANA:SetTotalInLine(.F.) 
oSecANA:SetHeaderBreak(.T.)                                                   
oSecANA:SetAutoSize(.F.)  
oSecANA:SetHeaderPage(.T.) 
oSecANA:SetCellBorder(5,1,,.T.)

//Habilita impressao
oReport:PrintDialog()

Return

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณNRFIN01   บAutor  ณMicrosiga           บ Data ณ  07/19/12   บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณ                                                            บฑฑ
ฑฑบ          ณ                                                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ AP                                                         บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/

Static Function PrintReport(oReport)

Private par01, par02, par03

par01 := cvaltochar(mv_par01)
par02 := DTOS(mv_par02)
par03 := DTOS(mv_par03)

BEGIN REPORT QUERY oSecANA
	BeginSql alias "TRB01"           

		SELECT RANK() OVER(ORDER BY ZL4.ZL4_NSERIE, REL.ZLD_RETIRO, REL.ZLD_RETILJ) ORDEM
		 , REL.ZLD_RETIRO ZLD_RETIRO, REL.ZLD_RETILJ ZLD_RETILJ, REL.ZLD_DCRRET ZLD_DCRRET 
		 , SUBSTRING(REL.ZLD_DTCOLE,1,8) ZLD_DTCOLE 
		 , ZLD.ZLD_FRETIS ZLD_FRETIS, ZLD.ZLD_LJFRET ZLD_LJFRET, A2.A2_NOME ZLD_DCFRET, ZL4.ZL4_PLACA ZL4_PLACA 
		 , ZL4.ZL4_NSERIE ZL4_EQPTO, ZL0.ZL0_NOME ZL0_NOME 
		 , ZLD.ZLD_LINROT ZLD_LINROT, ZLD.ZLD_VERSAO ZLD_VERSAO, ZLD.ZLD_DESLIN ZLD_DESLIN 
		 FROM ( 
		 	SELECT ZLD_RETIRO, ZLD_RETILJ, ZLD_DCRRET, MAX(ZLD_DTCOLE+ZLD_HRREC) ZLD_DTCOLE 
		 	FROM %table:ZLD% ZLD 
		 	WHERE D_E_L_E_T_ = ' '  
		 	AND ZLD_FILIAL = '' 
		 	AND ZLD_DTCOLE BETWEEN %exp:par02% AND %exp:par03% 
		 	AND ZLD_RETIRO+ZLD_RETILJ 
		 		NOT IN (SELECT DISTINCT ZLB_RETIRO+ZLB_RETILJ FROM %table:ZLB% WHERE D_E_L_E_T_ = ' ' AND ZLB_TIPOFX = %exp:par01% AND ZLB_DATA BETWEEN %exp:par02% AND %exp:par03%) 
		 	GROUP BY ZLD_RETIRO, ZLD_RETILJ, ZLD_DCRRET 
		 ) REL           
		  INNER JOIN %table:ZLD% ZLD ON (ZLD.D_E_L_E_T_ = ' ' AND REL.ZLD_RETIRO+REL.ZLD_RETILJ+REL.ZLD_DTCOLE = ZLD.ZLD_RETIRO+ZLD.ZLD_RETILJ+ZLD.ZLD_DTCOLE+ZLD.ZLD_HRREC ) 
		  LEFT JOIN %table:ZL0% ZL0 ON (ZL0.D_E_L_E_T_ = ' ' AND ZLD.ZLD_MOTOR = ZL0.ZL0_COD) 
		  LEFT JOIN %table:ZL4% ZL4 ON (ZL4.D_E_L_E_T_ = ' ' AND ZLD.ZLD_VEICUL = ZL4.ZL4_COD) 
		  LEFT JOIN %table:SA2% A2 ON (A2.D_E_L_E_T_ = ' ' AND ZLD.ZLD_FRETIS+ZLD.ZLD_LJFRET = A2.A2_COD+A2.A2_LOJA) 
		 ORDER BY ZL4.ZL4_NSERIE, REL.ZLD_RETIRO, REL.ZLD_RETILJ 

	EndSql
END REPORT QUERY oSecANA

oSecANA:Print(.T.)



Return

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณ CriaSX1  บ Autor ณ TOTVS              บ Data ณ  00/00/00   บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณ Cria as perguntas (Parametros) do Boleto caso nao existam. บฑฑ
ฑฑบ          ณ                                                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Funcao Principal                                           บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function CriaSX1(cPerg)

aHelpPor := {}

 aTam	:= TamSX3("ZLB_TIPOFX")
 aAdd( aHelpPor, "Informe a Faixa")
 U_xPutSx1(cPerg, "01","Faixa? ","","","mv_ch1",aTam[3],aTam[1],aTam[2],0,"G","","ZL9_02","","","mv_par01","","","","","","","","","","","","","","","","",aHelpPor,{},{})
 
 aTam	:= TamSX3("ZLB_DATA")
 aHelpPor := {aHelpPor,"Informe o Periodo"}
 aAdd( aHelpPor, "Informe o Periodo")
 U_xPutSx1(cPerg, "02","Periodo De ? ","","","mv_ch02",aTam[3],aTam[1],aTam[2],0,"G","","","","","mv_par02","","","","","","","","","","","","","","","","",aHelpPor,{},{})
 U_xPutSx1(cPerg, "03","Periodo Ate ? ","","","mv_ch03",aTam[3],aTam[1],aTam[2],0,"G","","","","","mv_par03","","","","","","","","","","","","","","","","",aHelpPor,{},{})



Return()