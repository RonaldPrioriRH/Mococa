#INCLUDE "PROTHEUS.CH"
#INCLUDE "REPORT.CH"
#INCLUDE "TOPCONN.CH"
/*/

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัอออออออออออออหอออออออัอออออออออออออออออออออออหออออออออออออออออออัอออออออออออออออออออออออออออออออออออออออออออออปฑฑ
ฑฑบPrograma  ณRGLT019A     บ Autor ณ TOTVS                 บ Data da Criacao  ณ 24/05/2015             						บฑฑ
ฑฑฬออออออออออุอออออออออออออสอออออออฯอออออออออออออออออออออออสออออออออออออออออออฯอออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบDescricao ณ Demonstrativo de Associa็๕es                                                            						บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Gestao do Leite                                                   											บฑฑ
ฑฑบ          ณ 	 							                                                                                บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบParametrosณ                                                                                        						บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบRetorno   ณ Nenhum					                                                                                  	บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUsuario   ณ															                             						บฑฑ
ฑฑฬออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบSetor     ณ Gestao do Leite	                                                                       						บฑฑ
ฑฑฬออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบ            						ATUALIZACOES SOFRIDAS DESDE A CONSTRUAO INICIAL                   						บฑฑ
ฑฑฬออออออออออัออออออออออัออออออออออออออออออออออออออออออออออออออออออออออออออัออออออออออออออออออออออออออออออออออัอออออออออออออนฑฑ
ฑฑบAutor     ณ Data     ณ Motivo da Alteracao  				               ณUsuario(Filial+Matricula+Nome)    ณSetor        บฑฑ
ฑฑฬฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤฤฤฤนฑฑ
ฑฑบ          ณ          ณ                    							   ณ                                  ณ 			บฑฑ
ฑฑศออออออออออฯออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออฯออออออออออออออออออออออออออออออออออฯอออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function RGLT019A

Local nQtdReg := 0
Local cDesc   := "Este relatorio ira listar todos os debitos e creditos dos produtores, entrada de leite, analise da qualidade e convenios."

Private cpMix    := ""
Private cpSetor  := ""
Private cpPrdIni := ""
Private cpPrdFim := ""
Private cDiaPgto := ""
Private dpDtIni  := CTOD("")
Private dpDtFim  := CTOD("")
Private _lMostraPrc := .T.
Private oCB
Private oReport
Private cPerg  := "RGLT019A"
Private dBaixa := dDataBase

ValidPerg()
If !Pergunte(cPerg,.T.)
	Return
EndIf

DEFINE REPORT oReport NAME 'RGLT019A' TITLE 'Demonstrativo do Grupo de Produtor' PARAMETER cPerg ACTION {|oReport| RunRel(oReport)} DESCRIPTION cDesc

oReport:SetPortrait()// ou SetPortrait() - SetLandscape()
oReport:HideHeader() // Nao imprime cabecalho padrao do Protheus
oReport:HideFooter() // Nao imprime rodape padrao do Protheus
oReport:SetTotalInLine(.F.)

DEFINE SECTION OCB OF oReport TITLE "DEMONSTRATIVO"

oReport:PrintDialog()
Return

/*/

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัอออออออออออออหอออออออัอออออออออออออออออออออออหออออออออออออออออออัอออออออออออออออออออออออออออออออออออออออออออออปฑฑ
ฑฑบPrograma  ณRunRel       บ Autor ณ Abrahao P. Santos     บ Data da Criacao  ณ 24/01/2009             						บฑฑ
ฑฑฬออออออออออุอออออออออออออสอออออออฯอออออออออออออออออออออออสออออออออออออออออออฯอออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบDescricao ณ DemonSTRativo do Produtor                                                               						บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Gestao do Leite                                                   											บฑฑ
ฑฑบ          ณ 	 							                                                                                บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบParametrosณ                                                                                        						บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบRetorno   ณ Nenhum					                                                                                  	บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUsuario   ณ															                             						บฑฑ
ฑฑฬออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบSetor     ณ Gestao do Leite	                                                                       						บฑฑ
ฑฑฬออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบ            						ATUALIZACOES SOFRIDAS DESDE A CONSTRUAO INICIAL                   						บฑฑ
ฑฑฬออออออออออัออออออออออัออออออออออออออออออออออออออออออออออออออออออออออออออัออออออออออออออออออออออออออออออออออัอออออออออออออนฑฑ
ฑฑบAutor     ณ Data     ณ Motivo da Alteracao  				               ณUsuario(Filial+Matricula+Nome)    ณSetor        บฑฑ
ฑฑฬฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤลฤฤฤฤฤฤฤฤฤฤฤฤฤนฑฑ
ฑฑบ          ณ          ณ                    							   ณ                                  ณ 			บฑฑ
ฑฑศออออออออออฯออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออฯออออออออออออออออออออออออออออออออออฯอออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function RunRel()

Local xArea
Local nCount  := 0
Local nTab01  := 100
Local nTab02  := 800
Local nTab03  := 1000
Local nTab04  := 1600
Local nTab05  := 2050
Local nTotCre := 0
Local nTotDeb := 0
Local nTotVol := 0
Local nUltDia := 0
Local dQual1  := CTOD("")
Local dQual2  := CTOD("")
Local dQual3  := CTOD("")
Local nVolProd:= 0
Local xAlias  :=GetNextAlias()
Local nReg    := 0
Local nTotPend:= 0
Local cMasc   := ""
Local nRedut  := 0
Local cCodLin := ""
Local nItens  := 0
Local aMensagem := {}

// Agrupamento convenios e bonIficacoes
Local cLT_GRPBON := Trim(GETMV("LT_GRPBON"))//000002
Local cLT_GRPCNV := Trim(GETMV("LT_GRPCNV"))//000010
Local cLT_GRPEMP := Trim(GETMV("LT_GRPEMP"))//000011
Local cLT_EVEESTO:= ""//Trim(GETMV("LT_EVEESTO"))//990028
Local cLT_EVECOMP:= ""//Trim(GETMV("LT_EVECOMP"))//990010

Local cLT_EVELEG  := ""//Trim(GETMV("LT_EVELEG"))
Local cLT_EVEINSS := Trim(GETMV("LT_EVEINSS"))
Local cMixStatus  := ""
Local aDebito     := {}

Local nConvenios := 0
Local nConvJur   := 0
Local nVlrOrig   := 0
Local nConvPag   := 0
Local nBonIf     := 0
Local nRepasse   := 0
Local aConvenios := {}
Local aDeposito  := 0
Local lAgrupa    := GETMV("LT_AGRUBON")//Agrupa as bonificacoes
LOcal nCnt, n
Local _cFiltro := ""
Local _nQtdGrupo := 0

nL    := 0
nPos1 := 100
nPos2 := 350
nPos3 := 1500
nPos4 := 1800

nTab11 := 100
nTab12 := 400
nTab13 := 700
nTab14 := 1000
nTab15 := 1300
nTab16 := 1700
nTab17 := 2100

nColCv1 := 100
nColCv2 := 800
nColCv3 := nColCv2+300
nColCv4 := nColCv3+300
nColCv5 := nColCv4+300
nColCv6 := nColCv5+300
nColCv7 := nColCv6+300
oFontTitulo:=TFont():New("Arial",09,14,.T.,.T.,5,.T.,5,.T.,.F.)
oFontRotulo:=TFont():New("Arial",09,11,.T.,.T.,5,.T.,5,.T.,.F.)
oFontNormal:=TFont():New("Arial",09,11,.F.,.F.,5,.T.,5,.T.,.F.)
oFontDetCv1:=TFont():New("Courier New",09,11,.F.,.F.,5,.T.,5,.T.,.F.)
oFontDetCv2:=TFont():New("Courier New",09,11,.T.,.T.,5,.T.,5,.T.,.F.)

cRaizServer := If(IsSrvUnix(), "/", "\")

// Obtem parametros
cpMix	:= MV_PAR01
cpSetor	:= MV_PAR02
cpPrdIni:= MV_PAR03
cpPrdFim:= MV_PAR04
_lMostraPrc := IIF(MV_PAR05==1,.T.,.F.)

cDiaPgto:= ALLTRIM(GETMV("LT_VENCTO"))
dpDtIni := POSICIONE("ZLE",1,xFILIAL("ZLE")+cpMix,"ZLE_DTINI")
dpDtFim := POSICIONE("ZLE",1,xFILIAL("ZLE")+cpMix,"ZLE_DTFIM")
cDtSE2  := LEFT(dtos(dpDtIni),4)+StrZero(Month(dpDtIni),2)+(StrZero(Val(cDiaPgto)+1,2))

_cFiltro := "% '"+DTOS(dpDtIni)+"' AND '"+DTOS(dpDtFim)+"' %"


// Obtem dados de impressao
cQuery := "SELECT ZL5.ZL5_COD AS FORNEC,'' AS LOJA, ZL5.ZL5_DESCRI AS NOME  "
cQuery += " FROM ZLF010 ZLF "
cQuery += " JOIN ZL5010 ZL5 ON ZL5.ZL5_FILIAL = '"+xFILIAL("ZL5")+"' AND ZL5.ZL5_COD BETWEEN '"+cpPrdIni+"' AND '"+cpPrdFim+"' AND ZL5.D_E_L_E_T_ = ' '"
cQuery += " JOIN SA2010 A2 ON A2.A2_FILIAL = '"+xFILIAL("ZLF")+"' AND A2.A2_L_GRUPO = ZL5.ZL5_COD AND A2.A2_COD = ZLF.ZLF_RETIRO AND A2.D_E_L_E_T_ = ' ' "
cQuery += " 	AND A2.A2_LOJA = ZLF.ZLF_RETILJ AND A2.D_E_L_E_T_ = ' ' "
cQuery += " WHERE ZLF.D_E_L_E_T_ = ' ' "
cQuery += " AND ZLF.ZLF_FILIAL =  '"+xFILIAL("ZLF")+"' "
cQuery += " AND ZLF.ZLF_CODZLE = '"+cpMix+"' "
cQuery += " AND SUBSTRING(ZLF.ZLF_RETIRO,1,1) IN ('P','G') "
cQuery += " GROUP BY ZL5_COD,ZL5_DESCRI "
cQuery += " ORDER BY ZL5_COD,ZL5_DESCRI "

cQuery := ChangeQuery(cQuery)

If Select("TRB") <> 0
	TRB->(dbCloseArea("TRB"))
EndIf
dbUseArea( .T., "TOPCONN", TcGenQry(,,cQuery), "TRB", .T., .F. )
Count to nQtdReg

oReport:Section(1):Init()
oReport:SetMeter(nQtdReg)

TRB->(dbGoTop())
While !TRB->(Eof()) .And. !oReport:Cancel()

	//Quantidade total do grupo em litros
	If Select("QTD") <> 0
		QTD->(dbCloseArea("QTD"))
	EndIf

	BeginSql alias "QTD"
		SELECT SUM(ZLD_QTDBOM) QTDTOT FROM %Table:ZLD% ZLD
		JOIN %Table:SA2% A2 ON A2.A2_COD = ZLD.ZLD_RETIRO AND A2.A2_LOJA = ZLD.ZLD_RETILJ 
		AND A2.A2_L_GRUPO = %Exp:TRB->FORNEC% AND A2.%NOTDEL%
		WHERE ZLD_FILIAL = ''
		AND ZLD.%NOTDEL%
		AND ZLD_DTCOLE BETWEEN %Exp:_cFiltro%

	EndSql
	If !QTD->(Eof())
		_nQtdGrupo	:= QTD->QTDTOT      
	EndIf
	QTD->(dbCloseArea("QTD"))	
	// Cabecalho
	nCount++
	oReport:IncMeter()
	nL     := 50
	nItens := 0
	Cabec()
	
	// INICIO DOS EVENTOS DO PRODUTOR NA ZLF
    If _lMostraPrc

		nL += 10
		oReport:Say(nL,nTab01,"Eventos       ",oFontRotulo)
		oReport:Say(nL,nTab03,"Vlr do Litro (R$)",oFontRotulo)
		oReport:Say(nL,nTab04,"Creditos (R$)   ",oFontRotulo)
		oReport:Say(nL,nTab05,"D้bitos (R$)",oFontRotulo)
		nL += 50
		oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
		
		nL += 10
	EndIf
	cQuery := " SELECT A2_L_GRUPO AS GRUPO,ZLF_EVENTO AS EVENTO,ZLF_DEBCRE AS DEBCRE,MAX(ZLF_QTDBOM) AS QTDBOM, "
	cQuery += " SUM(ZLF_TOTAL) AS TOTAL,SUM(ZLF_VLRPAG) AS VLRPAG "
	cQuery += " ,MAX(ZL8.ZL8_NREDUZ) as DCREVE,MAX(ZL8.ZL8_GRUPO) ZL8_GRUPO, MAX(ZL8_DESCRI) ZL8_DESCRI "
	cQuery += " FROM "+RetSqlName("ZLF")+" ZLF "
	cQuery += " JOIN "+RetSqlName("ZL8")+" ZL8 ON  ZL8_FILIAL = '"+xFILIAL("ZL8")+"' AND  ZLF.ZLF_EVENTO = ZL8.ZL8_COD AND  ZL8.ZL8_RECIBO = 'S' "
	cQuery += " 	AND ZL8.ZL8_TPEVEN IN ('L','A','R' ) AND ZL8.D_E_L_E_T_ = ' ' "
	cQuery += " JOIN "+RetSqlName("SA2")+" A2 ON A2.A2_COD = ZLF.ZLF_RETIRO AND A2.A2_LOJA = ZLF.ZLF_RETILJ AND A2.A2_L_GRUPO = '"+TRB->FORNEC+"' "
	cQuery += " 	AND A2.D_E_L_E_T_ = ' ' "
	cQuery += " WHERE "
	cQuery += " ZLF_FILIAL = '"+xFILIAL("ZLF")+"' "
	cQuery += " AND ZLF_CODZLE = '"+cpMix+"' "
	cQuery += " AND ZLF_TP_MIX = 'L' "
	cQuery += " GROUP BY A2_L_GRUPO,ZLF_DEBCRE,ZL8_GRUPO,ZLF_EVENTO,ZLF_SEQ "
	cQuery += " ORDER BY A2_L_GRUPO,ZLF_DEBCRE,ZL8_GRUPO,ZLF_EVENTO "


	If Select("TRC") <> 0
		TRC->(dbCloseArea("TRC"))
	EndIf
	dbUseArea( .T., "TOPCONN", TcGenQry(,,cQuery), "TRC", .T., .F. )
	
	While !TRC->(Eof()) .And. !oReport:Cancel()
		
		//Se agrupa as bonificacoes
		If lAgrupa
			While !TRC->(Eof()) .And. Trim(TRC->ZL8_GRUPO) == cLT_GRPBON
				nQTBom  := _nQtdGrupo
				nBonIf  += TRC->TOTAL
				nTotCre += TRC->TOTAL
				TRC->(dbSkip())
			EndDo
		EndIf
		
		// IMPRIME BONIfICACOES AGRUPADAS
		If nBonIf > 0
			oReport:Say(nL,nTab01,"BONIfICAวีES",oFontRotulo)
			oReport:Say(nL,nTab03,TransForm(nBonIf/nQtBom,"@E 999,999,999.9999"),oFontNormal)
			oReport:Say(nL,nTab04,TransForm(nBonIf,"@E 999,999,999.99"),oFontNormal)
			nL += 50
			nBonIf := 0
			nItens += 1
		EndIf
		// FIM IMPRIME BONIfICACOES AGRUPADAS
		
		//Tratamento para nao imprimir uma linha em branco com valor zerado quando
		//o produtor nao tem nada de qualidade.
		If TRC->TOTAL > 0 .and.   _lMostraPrc
			oReport:Say(nL,nTab01,TRC->ZL8_DESCRI,oFontRotulo)
			
			If TRC->DEBCRE == "C"
				//Tratamento para nao imprimir valor litro de Repasse
				If AllTrim(TRC->ZL8_GRUPO) == ""//AllTrim(GetMv("LT_GRPREPA"))
					nRepasse += TRC->TOTAL
				Else
					oReport:Say(nL,nTab03,TransForm(TRC->TOTAL/_nQtdGrupo,"@E 999,999,999.9999"),oFontNormal)
				EndIf
				oReport:Say(nL,nTab04,TransForm(TRC->TOTAL,"@E 999,999,999.99"),oFontNormal)
				nTotCre+=TRC->TOTAL
				nItens += 1
			Else
				oReport:Say(nL,nTab05,TransForm(TRC->TOTAL,"@E 999,999,999.99"),oFontNormal)
				nTotDeb+=TRC->TOTAL
				nItens += 1
			EndIf
			nL += 50
		EndIf
		
		TRC->(dbSkip())
	EndDo
	
	//============ ALTERAวรO GUILHERME FRANวA - 08/11/13 - BUSQUEI A MESMA FORMULA DO PROGRAMA DA TELA DE CONSULTA (CGLT001)
	
	cMixStatus := POSICIONE("ZLF",1,XFILIAL("ZLF")+cpMix+'1'+TRB->FORNEC+TRB->LOJA,"ZLF_STATUS")
	
	If .t. //cMixStatus == 'F' // FECHADO  REGISTROS DO LEITE FICAM COM -S- E OS FINANCEIROS COMO -F-
		aDebito  := {}
		
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
		//ณ Consulta os lancamentos gerados pelo MIX e fechamento de leite.  ณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
		cQuery := " SELECT ZLF_SETOR,ZLF_CODZLE,ZLF_DEBCRE,ZLF_TOTAL,ZLF_EVENTO, ZLF_SE1HIS,ZLF_VLRPAG,ZLF_SE1JUR,ZLF_SE1VLR "
		cQuery += " FROM "+RetSqlName("ZLF")+" ZLF"
		cQuery += " JOIN "+RetSqlName("ZL8")+" ZL8 ON ZL8_FILIAL = ZLF_FILIAL AND ZL8_COD = ZLF_EVENTO AND ZL8_TPEVEN = 'F' AND ZL8.D_E_L_E_T_ = ' '"
		cQuery += " JOIN "+RetSqlName("SA2")+" A2 ON A2.A2_COD = ZLF.ZLF_RETIRO AND A2.A2_LOJA = ZLF.ZLF_RETILJ AND A2.A2_L_GRUPO = '"+TRB->FORNEC+"' "
		cQuery += " 	AND A2.D_E_L_E_T_ = ' ' "
		cQuery += " WHERE ZLF.D_E_L_E_T_ = ' '"
		cQuery += " AND ZLF_FILIAL = '" + xFILIAL("ZLF")+"'"
		cQuery += " AND ZLF_DTINI >= '" + DTOS(dpDtIni) + "'"
		cQuery += " AND ZLF_DTFIM <= '" + DTOS(dpDtFim) + "'"
		cQuery += " AND ZLF_DEBCRE = 'D' "
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
		//ณ Verifica se o arquivo temporario ja existe, se sim, deleta-o.  ณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
		If Select("TRAB2") <> 0
			TRAB2->(dbCloseArea("TRAB2"))
		EndIf
		
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
		//ณ Cria o arquivo temporario com base no Select. ณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
		TCQUERY cQuery NEW ALIAS("TRAB2")
		
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
		//ณ Posiciona no primeiro registro do arquivo temporario. ณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
		dbSelectArea("TRAB2")
		dbGoTop()
		While !TRAB2->(Eof())
			
			dbSelectArea("ZL8")
			dbSetOrder(1)
			dbSeek(xFILIAL("ZL8")+TRAB2->ZLF_EVENTO)
			
			AADD(aDebito,{TRAB2->ZLF_EVENTO,TRAB2->ZLF_TOTAL,TRAB2->ZLF_SE1HIS,TRAB2->ZLF_VLRPAG,TRAB2->ZLF_SE1JUR,TRAB2->ZLF_SE1VLR }) //ZL8->ZL8_DESCRI })
			
			// Passa para o proximo registro.
			TRAB2->(dbSkip())
		EndDo
		// Deleta o arquivo temporario.
		dbCloseArea("TRAB2")
		
		//============FIM ALTERAวรO GUILHERME
		
		// IMPRIME CONVENIOS
	Else
		


		aConvenios := U_RGLTCNV(TRB->FORNEC,TRB->LOJA,StrZero(Month(dpDtIni),2),LEFT(dtos(dpDtIni),4),cDiaPgto,cLT_GRPCNV,cpMix,.F.)
	EndIf
	//======GUILHERME
	
	aDeposito  := {} //U_RGLTDEP(TRB->FORNEC,TRB->LOJA,STRZero(Month(dpDtIni),2),LEFT(DTOS(dpDtIni),4),cDiaPgto)
	
	IF !EMPTY(aDebito)
		For nCnt := 1 to len(aDebito)
			AADD(aConvenios,{aDebito[nCnt,3],aDebito[nCnt,2],aDebito[nCnt,1],aDebito[nCnt,4],aDebito[nCnt,5],aDebito[nCnt,6] })
		Next
	EndIf
	//======GUILHERME
	
	//Ordena pela coluna valor pago
	If MV_PAR06 == 2//Se nao agrupa o Saldo Devedor
		aSort(aConvenios,,, { |x,y| x[4] > y[4] })
	EndIf
	
	For nCnt := 1 To Len(aConvenios)
		nConvenios += aConvenios[nCnt,2]
		nConvPag   += aConvenios[nCnt,4]
		nConvJur   += aConvenios[nCnt,5]
		nVlrOrig   += aConvenios[nCnt,6]
	Next
	
	If nConvenios > 0
		oReport:Say(nL,nTab01,"CONVสNIOS",oFontRotulo)
		//Tratamento para imprimir o valor total do convenio,
		//nas situacoes onde ja foi realizado o fechamento definitivo ou previsao
		If nConvenios > 0
			oReport:Say(nL,nTab05,Transform(nConvenios+nConvJur,"@E 999,999,999.99"),oFontNormal)
			nTotDeb += nConvenios+nConvJur
		Else
			oReport:Say(nL,nTab05,Transform(nConvPag,"@E 999,999,999.99"),oFontNormal)
			nTotDeb += nConvPag
		EndIf
		nL += 50
	EndIf
	// FIM IMPRIME CONVENIOS AGRUPADOS
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	
	nL += 10
	
	//Calcula o valor do desconto de redutor de qualidade.
	//O valor litro deve ser calculado, subtraindo-se o redutor de qualidade
	cCodLin := POSICIONE("SA2",1,xFILIAL("SA2")+TRB->FORNEC+TRB->LOJA,"A2_L_LI_RO")
	nRedut  := U_GetRedut(cpMix,TRB->FORNEC,TRB->LOJA,cpSetor," "," ")
	
	nVolProd:= _nQtdGrupo //U_VolLeite(xFILIAL("ZLF"),dpDtIni,dpDtFim,cpSetor,,TRB->FORNEC,TRB->LOJA)
//	oReport:Say(nL,nTab03,TransForm(( (nTotCre-nRedut-nRepasse)/nVolProd ),"@E 999,999,999.9999"),oFontRotulo)
	oReport:Say(nL,nTab03,TransForm(( nTotCre/nVolProd ),"@E 999,999,999.9999"),oFontRotulo)
	oReport:Say(nL,nTab04,TransForm(nTotCre,"@E 999,999,999.99"),oFontRotulo)
	oReport:Say(nL,nTab05,TransForm(nTotDeb,"@E 999,999,999.99"),oFontRotulo)
	
	If _lMostraPrc
		If ( nTotCre>=nTotDeb )
			oReport:Say(nL,nTab01,"LIQUIDO CREDOR: " + Trim(TransForm(nTotCre-nTotDeb,"@E 999,999,999.99")),oFontRotulo)
		Else
			oReport:Say(nL,nTab01,"LIQUIDO DEVEDOR: " + Trim(TransForm(nTotCre-nTotDeb,"@E 999,999,999.99")),oFontRotulo)
		EndIf
	EndIf	
	//IMPRIME DADOS DOS DEPOSITOS REALIZADOS PELOS PRODUTORES ANTES DO FECHAMENTO
//	If aDeposito[1] > 0
//		oReport:Say(nL+50,nTab01,aDeposito[2]+" "+ALLTrim(aDeposito[3])+" "+ Trim(TransForm(aDeposito[1],"@E 999,999,999.99")),oFontRotulo)
//	EndIf
	//Retirado dia 19/05/11 devido a impressao dos dados do recibo
	//nTotDeb:=0
	//nTotCre:=0
	
	// FIM DOS EVENTOS
	
	// INICIO DA RECEPCAO DIARIA DO LEITE
	nL += 100
	oReport:Say(nL,900,"VOLUME DE LEITE FORNECIDO",oFontRotulo)
	nL += 50
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	nL += 10
	
	// do dia 1 a 10
	oReport:Say(nL,nPos1,"Dia",oFontRotulo)
	For n:=1 to 10
		oReport:Say(nL,90+(n*190),Space(11-Len(ALLTrim(STR(n))))+ALLTrim(STR(n)),oFontRotulo)
	Next n
	nL += 50
	oReport:Say(nL,nPos1,"Volume",oFontRotulo)
	For n:=1 to 10
		nAux:=u_getVolDay(TRB->FORNEC,TRB->LOJA,SubStr(DTOS(dpDtIni),1,6)+STRZero(n,2),"A")
		oReport:Say(nL,110+(n*190),TransForm(nAux,"@E 999,999"),oFontNormal)
		nTotVol+=nAux
	Next n
	nL += 50
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	
	// do dia 11 a 20
	oReport:Say(nL,nPos1,"Dia",oFontRotulo)
	For n:=11 to 20
		oReport:Say(nL,90+((n-10)*190),Space(11-Len(ALLTrim(STR(n))))+ALLTrim(STR(n)),oFontRotulo)
	Next n
	nL += 50
	oReport:Say(nL,nPos1,"Volume",oFontRotulo)
	For n:=11 to 20
		nAux:=u_getVolDay(TRB->FORNEC,TRB->LOJA,SubStr(DTOS(dpDtIni),1,6)+STRZero(n,2),"A")
		oReport:Say(nL,110+((n-10)*190),TransForm(nAux,"@E 999,999"),oFontNormal)
		nTotVol+=nAux
	Next n
	nL += 50
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	
	// do dia 21 a 30
	oReport:Say(nL,nPos1,"Dia",oFontRotulo)
	nUltDia:=val(SubStr(DTOS(dpDtFim),7,2)) // ultimo dia do mes
	For n:=21 to nUltDia
		oReport:Say(nL,90+((n-20)*190),Space(11-Len(ALLTrim(STR(n))))+ALLTrim(STR(n)),oFontRotulo)
	Next n
	nL += 50
	oReport:Say(nL,nPos1,"Volume",oFontRotulo)
	For n:=21 to nUltDia
		nAux:=u_getVolDay(TRB->FORNEC,TRB->LOJA,SubStr(DTOS(dpDtIni),1,6)+STRZero(n,2),"A")
		oReport:Say(nL,110+((n-20)*190),TransForm(nAux,"@E 999,999"),oFontNormal)
		nTotVol+=nAux
	Next n
	nL += 50
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	nL += 10
	oReport:Say(nL,nPos1,"Total:",oFontRotulo)
	oReport:Say(nL,nPos2,TransForm(nTotVol,"@E 999,999,999")+" Litros",oFontNormal)
	oReport:Say(nL,nPos3,"Media Diแria:",oFontRotulo)
	oReport:Say(nL,nPos4,TransForm(nTotVol/nUltDia,"@E 999,999,999")+" Litros",oFontNormal)
	
	nTotVol:=0
	// FIM DA RECEPCAO
	
	// INICIO DO PAGTO POR QUALIDADE
	nL += 100
	oReport:Say(nL,900,"RESULTADO DE ANALISES",oFontRotulo)
	nL += 50
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	nL += 10
	oReport:Say(nL,nTab12,"Anแlise",oFontRotulo)
	oReport:Say(nL,nTab13,"Referencia",oFontRotulo)
	oReport:Say(nL,nTab14,'1ช Analise',oFontRotulo)
	oReport:Say(nL,nTab15,'2ช Analise',oFontRotulo)
	oReport:Say(nL,nTab16,"Media Aritm้tica",oFontRotulo)
	nL += 50
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	nL += 10
	
	dbSelectArea("ZL9")
	dbSetOrder(1)
	dbSeek(xFILIAL("ZL9"))
	While !Eof() .And. xFILIAL("ZL9")==ZL9->ZL9_FILIAL .And. !oReport:Cancel()
		If ZL9->ZL9_TIPO = "Q"
			oReport:Say(nL,nTab12,ZL9->ZL9_DESCRI,oFontNormal)
			oReport:Say(nL,nTab13,ZL9->ZL9_REFERE,oFontNormal)
			
			cMasc := Iif(ZL9->ZL9_COD $ "010003#010004","@E 9,999,999","@E 99,999.99")
			
			// Obtem valor da primeira analise
			nAux := U_GetIndice(xFILIAL("ZL8"),cpSetor,TRB->FORNEC,TRB->LOJA,ZL9->ZL9_COD,ZL9->ZL9_MEDIA,dpDtFim,'1')
			
			oReport:Say(nL,nTab14,TransForm(nAux,cMasc),oFontNormal)
			
			// Obtem valor da segunda analise
			nAux := U_GetIndice(xFILIAL("ZL8"),cpSetor,TRB->FORNEC,TRB->LOJA,ZL9->ZL9_COD,ZL9->ZL9_MEDIA,dpDtFim,'2')
			oReport:Say(nL,nTab15,TransForm(nAux,cMasc),oFontNormal)
			
			// Media
			nAux := U_GetIndice(xFILIAL("ZL8"),cpSetor,TRB->FORNEC,TRB->LOJA,ZL9->ZL9_COD,ZL9->ZL9_MEDIA,dpDtFim,'M')
			oReport:Say(nL,nTab16,TransForm(nAux,cMasc),oFontNormal)
			
			nL += 50
		EndIf
		dbSkip()
	EndDo
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	nL += 50
	// FIM DA QUALIDADE

	// DETALHAENTO DE VOLUME POR PRODUTOR DA ASSOCIAวรO
	If Select("TRBP")>0
		DbCloseArea("TRBP")
	EndIf
	BeginSql alias "TRBP"
		SELECT ZLD_RETIRO as PRODUTOR, A2_NOME as NOME, SUM(ZLD_QTDBOM) as QTD 
		FROM %Table:ZLD% ZLD
			JOIN %Table:SA2% A2 ON A2_COD = ZLD.ZLD_RETIRO AND A2_LOJA = ZLD.ZLD_RETILJ 
				AND A2_L_GRUPO = %Exp:TRB->FORNEC% AND A2.%NotDel%
		WHERE ZLD_FILIAL = ''
		AND ZLD.%NOTDEL%
		AND ZLD_DTCOLE BETWEEN %Exp:_cFiltro%

		GROUP BY ZLD_RETIRO, A2_NOME
		ORDER BY 2
	EndSql

	oReport:Say(nL,900,"VOLUME POR PRODUTOR",oFontRotulo)
	nL += 50
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	nL += 10
	oReport:Say(nL,nPos1,"C๓digo" ,oFontRotulo)
	oReport:Say(nL,nPos2,"Nome" ,oFontRotulo)
	oReport:Say(nL,nPos3,"Volume"  ,oFontRotulo)
	nL += 50
	DbSelectArea("TRBP")
	TRBP->(DbGotop())
	While !TRBP->(Eof())
		If oReport:Row() >= oReport:PageHeight() - 200
			nL+=20
			oReport:Say(nL,nTab03,"continua na pr๓xima pแgina...",oFontNormal)
			oReport:EndPage()
			nL := 50
			cabec()
		EndIf
		oReport:Say(nL,nPos1,TRBP->PRODUTOR ,oFontNormal)
		oReport:Say(nL,nPos2,TRBP->NOME ,oFontNormal)
		oReport:Say(nL,nPos3,TransForm(TRBP->QTD,"@E 999,999,999") ,oFontNormal)
		nL += 50
		TRBP->(DbSkip())
	EndDo
	DbCloseArea("TRBP")
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	nL += 10


	
	// DETALHAMENTO CONVENIO - alterar para mudar de pagina
	If Len(aConvenios) > 0
		oReport:Say(nL,900,"DETALHAMENTO CONVสNIO",oFontRotulo)
		nL += 50
		oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
		nL += 10
		If MV_PAR06 == 2//Nao aglutina os convenios
			oReport:Say(nL,nColCv2,"Vlr. Orig" ,oFontRotulo)
			oReport:Say(nL,nColCv3,"Sld. Tit." ,oFontRotulo)
			oReport:Say(nL,nColCv4,"Correcao"  ,oFontRotulo)
			oReport:Say(nL,nColCv5,"Sld. Dev." ,oFontRotulo)
			oReport:Say(nL,nColCv6,"Vlr. Pag." ,oFontRotulo)
			nL += 50
		EndIf
		
		For nCnt := 1 To Len(aConvenios)
			// para imprime em nova pแgina caso ultrapasse o tamanho da pagina atual
			If nCnt == ( 33 - nItens )
				nL+=20
				oReport:Say(nL,nTab03,"continua na pr๓xima pแgina...",oFontNormal)
				oReport:EndPage()
				nL := 50
				cabec()
			EndIf
			
			If aConvenios[nCnt,3] != cLT_EVEINSS
				If MV_PAR06 == 2//Nao aglutina o saldo devedor
					If (aConvenios[nCnt,2]+aConvenios[nCnt,4]+aConvenios[nCnt,5]+aConvenios[nCnt,6]) > 0
						oReport:Say(nL,nColCv1,SubStr(aConvenios[nCnt,1],1,35),oFontNormal)//Descricao do convenio
						oReport:Say(nL,nColCv2,Transform(aConvenios[nCnt,6],"@E 999,999.99"),oFontNormal)//Vlr. Orig
						oReport:Say(nL,nColCv3,Transform(aConvenios[nCnt,2],"@E 999,999.99"),oFontNormal)//Sld. Tit.
						oReport:Say(nL,nColCv4,Transform(aConvenios[nCnt,5],"@E 999,999.99"),oFontNormal)//Juros/Correcao
						oReport:Say(nL,nColCv5,Transform(aConvenios[nCnt,2]+aConvenios[nCnt,5],"@E 999,999.99"),oFontNormal)//Sld. Dev.
						oReport:Say(nL,nColCv6,Transform(aConvenios[nCnt,4],"@E 999,999.99"),oFontNormal)//Vlr. Pag.
					EndIf
					
				Else
					oReport:Say(nL,nTab11,aConvenios[nCnt,1],oFontNormal)
					oReport:Say(nL,nTab16,TransForm(aConvenios[nCnt,2],"@E 999,999.99"),oFontNormal)
				EndIf
			EndIf
			nL += 50
		Next
		oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
		nL += 10
		
		If MV_PAR06 == 2//Nao aglutina os convenios
			oReport:Say(nL,nColCv1,Space(10)+"TOTAL",oFontRotulo)
			oReport:Say(nL,(nColCv2),Transform(nVlrOrig  ,"@E 999,999,999.99"),oFontNormal)
			oReport:Say(nL,(nColCv3),Transform(nConvenios,"@E 999,999,999.99"),oFontNormal)
			oReport:Say(nL,(nColCv4),Transform(nConvJur  ,"@E 999,999,999.99"),oFontNormal)
			oReport:Say(nL,(nColCv5),Transform(nConvenios+nConvJur,"@E 999,999,999.99"),oFontNormal)
			oReport:Say(nL,(nColCv6),Transform(nConvPag  ,"@E 999,999,999.99"),oFontNormal)
		Else
			oReport:Say(nL,nTab11,Space(10)+"TOTAL",oFontRotulo)
			oReport:Say(nL,(nTab16),TransForm(nConvenios,"@E 999,999,999.99"),oFontRotulo)
		EndIf
		
		//Inicio da impressao dos dados do recibo
		If _lMostraPrc
			nL += 50
			oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
			nL += 10
			oReport:Say(nL,900,"RECIBO",oFontRotulo)
			nL += 40
			If ( nTotCre>=nTotDeb )
				oReport:Say(nL,nTab01,"Declaro haver recebido da "+AllTrim(SM0->M0_NOME)+" a importโncia de R$ " + AllTrim(Transform(nTotCre-nTotDeb,"@E 999,999.99")),oFontRotulo)
			Else
				oReport:Say(nL,nTab01,"Declaro meu saldo devedor para com a "+AllTrim(SM0->M0_NOME)+" na importโncia de R$ " + AllTrim(Transform(nTotCre-nTotDeb,"@E 9,999,999.99")),oFontRotulo)
			EndIf
			nL += 120
			oReport:FillRect({nL,900,nL+1,100},TBrush():New("",0))
			nL += 10
			oReport:Say(nL,nTab01,ALLTRIM(SA2->A2_NOME),oFontRotulo)
		EndIf
		nTotDeb :=0
		nTotCre :=0
		nRepasse:=0
		nL += 100
	Else
		//Inicio da impressao dos dados do recibo
		If _lMostraPrc
			nL += 50
			oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
			nL += 10
			oReport:Say(nL,900,"RECIBO",oFontRotulo)
			nL += 40
			If ( nTotCre>=nTotDeb )
				oReport:Say(nL,nTab01,"Declaro haver recebido da "+AllTrim(SM0->M0_NOME)+" a importโncia de R$ " + AllTrim(Transform(nTotCre-nTotDeb,"@E 999,999.99")),oFontRotulo)
			Else
				oReport:Say(nL,nTab01,"Declaro meu saldo devedor para com a "+AllTrim(SM0->M0_NOME)+" na importโncia de R$ " + AllTrim(Transform(nTotCre-nTotDeb,"@E 9,999,999.99")),oFontRotulo)
			EndIf
			nL += 120
			oReport:FillRect({nL,900,nL+1,100},TBrush():New("",0))
			nL += 10
			oReport:Say(nL,nTab01,ALLTRIM(SA2->A2_NOME),oFontRotulo)
		EndIf
		nTotDeb :=0
		nTotCre :=0
		nRepasse:=0
		nL += 100
	EndIf
	// FIM DETALHAMENTO CONVENIO
	
	//Zera as variaveis para o proximo produtor
	nConvenios := 0
	nConvJur   := 0
	nConvPag   := 0
	nVlrOrig   := 0
	nTotDeb    := 0
	nTotCre    := 0
	
	oReport:EndPage()
	TRB->(dbSkip())
EndDo

TRB->(dbCloseArea())
oReport:Section(1):Finish()
Return(Nil)


/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณRGLT019A  บAutor  ณMicrosiga           บ Data ณ  10/19/10   บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณ                                                            บฑฑ
ฑฑบ          ณ                                                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ AP                                                        บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function Cabec

Local cLogo := GetSrvProfString("Startpath","") + "DANFE01.bmp"

oReport:SayBitmap(nL,100,cLogo,186,155)

nL += 50
oReport:Say(nL,900,"Demonstrativo do Grupo de Produtor" + Space(30) + MesExtenso(STR(Month(dpDtIni)))+" - "+STR(YEAR(dpDtFim),4),oFontTitulo)

nL += 130
oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
nL += 10
// FIM DO CABECALHO

// INICIO DOS DADOS DO PRODUTOR
If Select("GRUPO") <> 0
	GRUPO->(dbCloseArea("GRUPO"))
EndIf


BeginSql alias "GRUPO"
	SELECT MAX(A2_COD) AS A2_COD, MAX(A2_LOJA) AS A2_LOJA
	FROM %Table:SA2% A2
	WHERE A2_L_GRUPO = %Exp:TRB->FORNEC%
	AND A2_L_ASSOC = 'S'
	AND A2.%NOTDEL%
EndSql

// Posiciona no Produtor
dbSelectArea("SA2")
dbSetOrder(1)
dbSeek(xFILIAL("SA2")+GRUPO->A2_COD+GRUPO->A2_LOJA)

//nL += 50
oReport:Say(nL,nPos1,"PRODUTOR:",oFontRotulo)
oReport:Say(nL,nPos2,SA2->A2_COD+ " " + SA2->A2_LOJA + " - " + SA2->A2_NOME,oFontNormal)
oReport:Say(nL,nPos3,"CPF:",oFontRotulo)
oReport:Say(nL,nPos4,TransForm(SA2->A2_CGC,"@R 999.999.999-99"),oFontNormal)

nL += 50
oReport:Say(nL,nPos1,"FAZENDA:",oFontRotulo)
//oReport:Say(nL,nPos2,Trim(SA2->A2_L_FAZEN)+Iif(SA2->A2_L_ENTDC=="T","",Space(5)+"-"+Space(5) + SA2->A2_L_ENTDC),oFontNormal)
oReport:Say(nL,nPos2,Trim(SA2->A2_END)+Iif(SA2->A2_L_ENTDC=="T","",Space(5)+"-"+Space(5) + SA2->A2_L_ENTDC),oFontNormal)
oReport:Say(nL,nPos3,"INSCRICAO:",oFontRotulo)
oReport:Say(nL,nPos4,SA2->A2_INSCR,oFontNormal)

nL += 50
oReport:Say(nL,nPos1,"MUNICIPIO:",oFontRotulo)
//oReport:Say(nL,nPos2,Trim(SA2->A2_MUN) + " - " + SA2->A2_EST,oFontNormal)
oReport:Say(nL,nPos2,AllTrim(Posicione("CC2",1,xFilial("CC2")+SA2->A2_EST+SA2->A2_COD_MUN,"CC2_MUN")) + " - " + SA2->A2_EST,oFontNormal)

oReport:Say(nL,nPos3,"ROTA:",oFontRotulo)
oReport:Say(nL,nPos4,SA2->A2_L_LI_RO+" - "+POSICIONE("ZL3",1,xFILIAL("ZL3")+SA2->A2_L_LI_RO,"ZL3_DESCRI"),oFontNormal)

If .f.//!Empty(SA2->A2_BANCO) Retirado a pedido de Eugenio para nใo aparecer os dados bancarios do produtor 
	nL += 50
	oReport:Say(nL,nPos1,"BANCO: ",oFontRotulo)
	oReport:Say(nL,nPos2,SA2->A2_BANCO,oFontNormal)
	oReport:Say(nL,nTab13,"AGENCIA: ",oFontRotulo)
	oReport:Say(nL,nTab13+250,SA2->A2_AGENCIA,oFontNormal)
	oReport:Say(nL,nPos3,"CONTA: ",oFontRotulo)
	oReport:Say(nL,nPos4,SA2->A2_NUMCON,oFontNormal)
EndIf

nL += 50
oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))

// FIM DOS DADOS DO PRODUTOR
Return

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณ ValidPergบ Autor ณ Microsiga          บ Data ณ  04/22/10   บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณ                                                            บฑฑ
ฑฑบ          ณ                                                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ                                                            บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function ValidPerg()

Local aHelpPor := {}
Local aHelpSpa := {}
Local aHelpEng := {}

//Do Mix
aHelpPor := {}
Aadd( aHelpPor, 'Codigo do Mix a ser considerado     ')
U_xPutSx1(cPerg,"01","Do Mix"," "," ","mv_ch1","C",6,0,0,"G","MV_PAR01:=STRZero(VAL(MV_PAR01),6)","ZLE_02","","","MV_PAR01","","","","","","","","","","","","","","","","",aHelpPor,aHelpEng,aHelpSpa)

//Do Setor
aHelpPor := {}
Aadd( aHelpPor, 'Informe o codigo do Setor')
Aadd( aHelpPor, 'que deseja filtrar.                 ')
U_xPutSx1(cPerg,"02","Setor   "," "," ","mv_ch2","C",6,0,0,"G",'U_ValSetPar()',"ZL2_01","","","MV_PAR02","","","","","","","","","","","","","","","","",aHelpPor,aHelpEng,aHelpSpa)

//Do Produtor
aHelpPor := {}
Aadd( aHelpPor, 'Informe o codigo inicial do grupo de')
Aadd( aHelpPor, 'produtor que deseja filtrar.        ')
U_xPutSx1(cPerg,"03","Do Grupo Produtor"," "," ","mv_ch3","C",6,0,0,"G","","ZL5","","","MV_PAR03","","","","","","","","","","","","","","","","",aHelpPor,aHelpEng,aHelpSpa)

//Ate Produtor
aHelpPor := {}
Aadd( aHelpPor, 'Informe o codigo final do grupo de  ')
Aadd( aHelpPor, 'produtor que deseja filtrar.        ')
U_xPutSx1(cPerg,"04","Ate Grupo Produtor"," "," ","mv_ch4","C",6,0,0,"G","","ZL5","","","MV_PAR04","","","","","","","","","","","","","","","","",aHelpPor,aHelpEng,aHelpSpa)


//Imprime Produtor sem movimento de leite
aHelpPor := {}
Aadd( aHelpPor, 'Informe SIM para demonstrar a precifica็ใo')
Aadd( aHelpPor, 'do leite dos produtores do grupo.   ')
Aadd( aHelpPor, 'Os valores serao apresentados somados')
U_xPutSx1(cPerg,"05","Demonstra Pre็os?","","","mv_ch5","C",1,0,0,"C",'',"","","","MV_PAR05","Sim","","","","Nao","","","","","","","","","","","",aHelpPor,aHelpEng,aHelpSpa)



//Detalha o saldo devedor
aHelpPor := {}
Aadd( aHelpPor, 'Informe NAO para que o saldo devedor')
Aadd( aHelpPor, 'seja detalhado e as compras na loja ')
Aadd( aHelpPor, 'sejam listadas pelo nro da nota.    ')
Aadd( aHelpPor, 'Informe SIM para que o saldo devedor')
Aadd( aHelpPor, 'seja agrupado e as compras na loja  ')
Aadd( aHelpPor, 'sejam listadas item a item.         ')
U_xPutSx1(cPerg,"06","Aglutina Sld Dev.","","","mv_ch6","C",1,0,0,"C",'',"","","","MV_PAR06","Sim","","","","Nao","","","","","","","","","","","",aHelpPor,aHelpEng,aHelpSpa)


Return()
