#INCLUDE "PROTHEUS.CH"
#INCLUDE "REPORT.CH"
#INCLUDE "TOPCONN.CH"
/*/
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³RGLT063      º Autor ³ TOTVS                 º Data da Criacao  ³ 28/07/2017            						º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDescricao ³ Recibo pagamento do carreteiro                                                               						º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ Gestao do Leite                                                   											º±±
±±º          ³ 	 							                                                                                º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºParametros³                                                                                        						º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºRetorno   ³ Nenhum					                                                                                  	º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUsuario   ³															                             						º±±
±±ÌÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºSetor     ³ Gestao do Leite	                                                                       						º±±
±±ÌÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±º            						ATUALIZACOES SOFRIDAS DESDE A CONSTRU€AO INICIAL                   						º±±
±±ÌÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºAutor     ³ Data     ³ Motivo da Alteracao  				               ³Usuario(Filial+Matricula+Nome)    ³Setor        º±±
±±ÌÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÄÅÄÄÄÄÄÄÄÄÄÄÄÄÄ¹±±
±±º          ³          ³                    							   ³                                  ³ 			º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
User Function RGLT063

Local nQtdReg:=0

Private oCB
Private oReport
Private dpDtIni  := CTOD("")
Private dpDtFim  := CTOD("")
Private cPerg    := PADR("RGLT063",10)
Private aOrd     := {"Nome","Codigo+Loja"}

ValidPerg()
If !Pergunte(cPerg,.T.)
	Return
EndIf

DEFINE REPORT oReport NAME 'RGLT063' TITLE "Recibo de Pagamento Carreteiros" PARAMETER cPerg ACTION {|oReport| runRel(oReport)}

oReport:SetPortrait()// ou SetPortrait() - SetLandscape()
oReport:HideHeader() // Nao imprime cabecalho padrao do Protheus
oReport:HideFooter() // Nao imprime rodape padrao do Protheus
oReport:SetTotalInLine(.F.)
oReport:lParamPage	:= .F.

DEFINE SECTION OCB OF oReport TITLE "RECIBO" ORDERS aOrd

oReport:PrintDialog()

Return


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ RunRel   º Autor ³ Microsiga          º Data ³  00/00/00   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³                                                            º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³                                                            º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function RunRel()

Local xArea
Local nCount  := 0
Local nTab01  := 150
Local nTab02  := 1100
Local nTab03  := 1500
Local nTab04  := 1600
Local nTab05  := 2050
Local nReg    := 0
Local _nTotBruto := 0
Local _nDesconto := 0
Local cMasc   := ""
Local nRedut  := 0
Local cCodLin := ""
Local nItens  := 0
Local nOrdem  := OCB:GetOrder()
Local aMensagem := {}
Local _cAlias := GetNextAlias()
Local _cEveQuebra := Alltrim(GetMv("LT_EVEQUEB"))

Private _cAliasCred := GetNextAlias()
Private _cAliasDeb := GetNextAlias()
                
DbSelectArea("ZLE")
DbSetOrder(1)
DbSeek(xFilial("ZLE")+MV_PAR01)

dpDtIni := ZLE->ZLE_DTINI
dpDtFim := ZLE->ZLE_DTFIM


nL    := 0
nPos1 := 100
nPos2 := 350
nPos3 := 1500
nPos4 := 1800

nTab11 := 100
nTab12 := 400
nTab13 := 700
nTab14 := 1000
nTab15 := 1300
nTab16 := 1700
nTab17 := 2100

/*
oFontTitulo:=TFont():New("Arial",09,14,.T.,.T.,5,.T.,5,.T.,.F.)
oFontRotulo:=TFont():New("Courier New",09,14,.T.,.T.,5,.T.,5,.T.,.F.)
//oFontNormal:=TFont():New("Arial",09,11,.F.,.F.,5,.T.,5,.T.,.F.)
oFontNormal:=TFont():New("Courier New",09,14,.F.,.F.,5,.T.,5,.T.,.F.)
oFontDetCv1:=TFont():New("Courier New",09,11,.F.,.F.,5,.T.,5,.T.,.F.)
oFontDetCv2:=TFont():New("Courier New",09,11,.T.,.T.,5,.T.,5,.T.,.F.)
*/
oFontTitulo:=TFont():New("Arial",09,14,.T.,.T.,5,.T.,5,.T.,.F.)
oFontRotulo:=TFont():New("Arial",09,11,.T.,.T.,5,.T.,5,.T.,.F.)
oFontNormal:=TFont():New("Arial",09,11,.F.,.F.,5,.T.,5,.T.,.F.)
oFontDetCv1:=TFont():New("Courier New",09,11,.F.,.F.,5,.T.,5,.T.,.F.)
oFontDetCv2:=TFont():New("Courier New",09,11,.T.,.T.,5,.T.,5,.T.,.F.)

// Obtem parametros

// Obtem dados de impressao
CriaTab(_cAlias,nOrdem)

dbSelectArea(_cAlias)
Count To nQtdReg


oReport:Section(1):Init()
oReport:SetMeter(nQtdReg)

(_cAlias)->(dbgotop())
While !(_cAlias)->(Eof()) .And. !oReport:Cancel()
	
	// Cabecalho
	nCount++
	oReport:IncMeter()
	nL     := 100
	nItens := 0
	

	
	Cabec(_cAlias)

	oReport:Say(nL,nPos1,"LITRAGEM TOTAL TRANSPORTADA:   "+ Transform((_cAlias)->QTDTOT,"@E 999,999,999"),oFontRotulo)
	
	nL += 80
	//oReport:Say(nL,nPos1,"VALOR DOS SERVIÇOS ",oFontRotulo)
	//oReport:Say(nL,nTab01+350,PADR("Linha",12),oFontRotulo)	
	oReport:Say(nL,nPos1+10,PADR("Linha",12),oFontRotulo)
	oReport:Say(nL,nTab01+200,"VALOR DOS SERVIÇOS ",oFontRotulo)
	oReport:Say(nL,nTab02,PADR("Quantidade",12),oFontRotulo)
	oReport:Say(nL,nTab03,PADR("Valor Unit.",12),oFontRotulo)
	oReport:Say(nL,nTab05,PADR("Valor Total",14),oFontRotulo)	
	nL += 80
	
	Creditos((_cAlias)->CODSA2,(_cAlias)->LOJA)
	
	While !(_cAliasCred)->(Eof())

		//oReport:Say(nL,nTab01,Alltrim((_cAliasCred)->DESCRI),oFontNormal)
		//oReport:Say(nL,nTab01+350,Alltrim((_cAliasCred)->LINHA),oFontNormal)		
		oReport:Say(nL,nTab01,Alltrim((_cAliasCred)->LINHA),oFontNormal)
		oReport:Say(nL,nTab01+200,Alltrim((_cAliasCred)->DESCRI),oFontNormal)
		oReport:Say(nL,nTab02,PADL(Alltrim(Transform((_cAliasCred)->QTD,"@E 999,999,999")),12),oFontNormal)		
		oReport:Say(nL,nTab03,PADL(Alltrim(Transform((_cAliasCred)->UNIT,"@E 9.9999")),12),oFontNormal)
		_nValor := IIF((_cAliasCred)->DEBCRE == 'D',(_cAliasCred)->VALOR * -1,(_cAliasCred)->VALOR)
		_nTotBruto += _nValor
		oReport:Say(nL,nTab05,"R$  "+PADL(Alltrim(Transform(_nValor,"@E 99,999,999.99")),14),oFontNormal)

		oReport:Line(nL+42,nTab02,nL+42,nTab05+250) 
		nL += 50		
		(_cAliasCred)->(DbSkip())
	EndDo
	nL += 20
	oReport:Say(nL,nTab04,"TOTAL BRUTO ",oFontRotulo)
	oReport:Say(nL,nTab05,"R$  "+PADL(Alltrim(Transform(_nTotBruto,"@E 99,999,999.99")),14),oFontRotulo)
	nL += 80
	
	oReport:Say(nL,nPos1,"DESCONTOS ",oFontRotulo)
	oReport:Say(nL,nTab05,PADL("Valor Total",14),oFontRotulo)	
	nL += 80	

	Debitos((_cAlias)->CODSA2,(_cAlias)->LOJA)
	
	While !(_cAliasDeb)->(Eof())
		oReport:Say(nL,nTab01,Alltrim((_cAliasDeb)->DESCRI),oFontNormal)
		If  (_cAliasDeb)->CODIGO == _cEveQuebra
			oReport:Say(nL,nTab02,PADL(Alltrim(Transform((_cAlias)->QUEBRA,"@E 999,999,999")),12),oFontNormal)
			oReport:Say(nL,nTab03,PADL(Alltrim(Transform((_cAliasDeb)->VALOR/(_cAlias)->QUEBRA,"@E 99.9999")),10),oFontNormal)
		EndIf
		oReport:Say(nL,nTab05,"R$  "+PADL(Alltrim(Transform((_cAliasDeb)->VALOR,"@E 99,999,999.99")),14),oFontNormal)
		_nDesconto += (_cAliasDeb)->VALOR
		oReport:Line(nL+42,nTab02,nL+42,nTab05+250) 
		nL += 50
		(_cAliasDeb)->(DbSkip())
	EndDo
	//oReport:Line(nL,nTab02,nL,nTab05+250)
	nL += 20
	oReport:Say(nL,nTab04,"TOTAL DESCONTO ",oFontRotulo)
	oReport:Say(nL,nTab05,"R$  "+PADL(Alltrim(Transform(_nDesconto,"@E 99,999,999.99")),14),oFontRotulo)
	
	nL += 80
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	nL += 20
	oReport:Say(nL,nTab04,"TOTAL LÍQUIDO ",oFontRotulo)
	oReport:Say(nL,nTab05,"R$  "+PADL(Alltrim(Transform(_nTotBruto - _nDesconto,"@E 99,999,999.99")),14),oFontRotulo)
	nL += 70
	oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
	nL += 50

	nL += 250

	oReport:Say(nL,nTab03,"Data, "+dtoc(dDataBase),oFontRotulo)
	nL +=150
	
	oReport:Line(nL-20,nTab03-50,nL-20,nTab05+150) 
	oReport:Say(nL,nTab03+150,"Assinatura",oFontNormal)	;nL += 200
	                                            
	
	
	_nTotBruto := 0
	_nDesconto := 0
	_nValor := 0
	
	oReport:EndPage()
	(_cAlias)->(dbSkip())
EndDo
(_cAlias)->(dbCloseArea())

oReport:Section(1):Finish()

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³CriaTab ºAutor  ³Microsiga             º Data ³  04/11/16   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Cria tabela temporária para impressão do relatório.        º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function CriaTab(_cAlias,xnOrdem)

Local nOrdem := xnOrdem
Local cOrdem := ""


If nOrdem == 1
	cOrdem := "% ZM0_NOME,ZM0_CODSA2,ZM0_LOJSA2 %"
Else
	cOrdem := "% ZM0_CODSA2,ZM0_LOJSA2 %"
EndIf

If Select(_cAlias) <> 0
	(_cAlias)->(DbCloseArea())
EndIf

BeginSql Alias _cAlias

	SELECT ZM0_CODSA2 AS CODSA2,
	ZM0_LOJSA2 AS LOJA,
	ZM0_NOME AS NOME,
    ZM0_TOTPRD AS QTDTOT,
    ZM0_QTDDES AS QUEBRA
	FROM %Table:ZM0% M0 
	WHERE M0.ZM0_FILIAL = %xFilial:ZM0% 
	AND M0.ZM0_MIX =  %Exp:MV_PAR01% 
	AND M0.ZM0_CODSA2 BETWEEN %Exp:MV_PAR02% AND %Exp:MV_PAR03%
	AND M0.%NotDel%
	ORDER BY %Exp:cOrdem%

EndSql


Return
/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³CriaTab ºAutor  ³Microsiga             º Data ³  04/11/16   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Cria tabela temporária para impressão do relatório.        º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function Creditos(xcCod,xcLoja)


If Select(_cAliasCred) <> 0
	(_cAliasCred)->(DbCloseArea())
EndIf

BeginSql Alias _cAliasCred

	SELECT ZM1_MIX, ZM1_OCORRE, ZM1_DSCOCO AS DESCRI, ZM1_DEBCRE,
		ZM1_QTDADE AS QTD,
	    ZM1_VALOR AS UNIT,
	    ZM1_VLRTOT AS VALOR,
	    ZM1_DEBCRE AS DEBCRE,
	    ZM1_LINHA AS LINHA
	
	FROM %Table:ZM1% M1
	WHERE ZM1_MIX = %Exp:MV_PAR01% 
	AND M1.ZM1_CODSA2 = %Exp:xcCod% 
	AND M1.ZM1_LOJSA2 = %Exp:xcLoja%
	AND M1.%NotDel%
	ORDER BY ZM1_OCORRE,ZM1_DEBCRE
EndSql


Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³CriaZM2 ºAutor  ³Microsiga             º Data ³  04/11/16   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³ Cria tabela temporária para impressão do relatório.        º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³ AP                                                         º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function Debitos(xcCodigo,xcLoja)



If Select(_cAliasDeb) <> 0
	(_cAliasDeb)->(DbCloseArea())
EndIf


BeginSql Alias _cAliasDeb

	SELECT ZM2_EVENTO AS CODIGO,
	       ZM2_VALOR AS VALOR,
	       ZM2_DESCRI AS DESCRI
	FROM %Table:ZM2% M2
	WHERE ZM2_MIX = %Exp:MV_PAR01%
		AND ZM2_CODSA2 = %Exp:xcCodigo%
		AND ZM2_LOJSA2 = %Exp:xcLoja%
		AND M2.%NotDel%
EndSql


Return


/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ Cabec    º Autor ³ Microsiga          º Data ³  00/00/00   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³                                                            º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³                                                            º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static Function Cabec(xAlias)

Local _cAlias := xAlias
Local cLogo := GetSrvProfString("Startpath","") + "logo_relato.bmp"

Local _nPos1 := 100
Local _nPos2 := 350
Local _nPos3 := 1500
Local _nPos4 := 1800
Local _nPos5 := 700

oReport:SayBitmap(nL,100,cLogo,450,300)

nL += 50
oReport:Say(nL,700,"RECIBO DE PAGAMENTO - PRESTAÇÃO DE SERVIÇO" + Space(15) + MesExtenso(STR(Month(dpDtIni)))+" - "+STR(YEAR(dpDtFim),4),oFontTitulo)

nL += 80
oReport:Say(nL,800,Alltrim(SM0->M0_NOMECOM) + Space(5) + " - "+Space(5) +Alltrim(SM0->M0_CIDCOB),oFontNormal)


nL += 250
oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
nL += 20
// FIM DO CABECALHO

// INICIO DOS DADOS DO CARRETEIRO

// Posiciona no Produtor
dbSelectArea("SA2")
dbSetOrder(1)
dbSeek(xFILIAL("SA2")+(_cAlias)->CODSA2+(_cAlias)->LOJA)

//nL += 50
oReport:Say(nL,_nPos1,"NOME:",oFontRotulo)
oReport:Say(nL,_nPos2,SA2->A2_COD+ " " + SA2->A2_LOJA + " - " + SA2->A2_NOME,oFontNormal)

If SA2->A2_TIPO == 'J'
	oReport:Say(nL,_nPos3,"CNPJ:",oFontRotulo)
	oReport:Say(nL,_nPos4,TransForm(SA2->A2_CGC,"@R 99.999.999/9999-99"),oFontNormal)
Else	
	oReport:Say(nL,_nPos3,"CPF:",oFontRotulo)
	oReport:Say(nL,_nPos4,TransForm(SA2->A2_CGC,"@R 999.999.999-99"),oFontNormal)
EndIf	
nL += 50
oReport:Say(nL,_nPos1,"ENDEREÇO:",oFontRotulo)
//oReport:Say(nL,_nPos2,Trim(SA2->A2_L_FAZEN)+Iif(SA2->A2_L_ENTDC=="T","",Space(5)+"-"+Space(5) + SA2->A2_L_ENTDC),oFontNormal)
oReport:Say(nL,_nPos2,Trim(SA2->A2_END)+Iif(!Empty(SA2->A2_NR_END),","+SA2->A2_NR_END," ")+" - "+Alltrim(SA2->A2_BAIRRO),oFontNormal)
oReport:Say(nL,_nPos3,"INSCRICAO:",oFontRotulo)
oReport:Say(nL,_nPos4,SA2->A2_INSCR,oFontNormal)

nL += 50
oReport:Say(nL,_nPos1,"MUNICIPIO:",oFontRotulo)
//oReport:Say(nL,_nPos2,Trim(SA2->A2_MUN) + " - " + SA2->A2_EST,oFontNormal)
oReport:Say(nL,_nPos2,AllTrim(Posicione("CC2",1,xFilial("CC2")+SA2->A2_EST+SA2->A2_COD_MUN,"CC2_MUN")) + " - " + SA2->A2_EST,oFontNormal)

//oReport:Say(nL,_nPos3,"ROTA:",oFontRotulo)
//oReport:Say(nL,_nPos4,SA2->A2_L_LI_RO+" - "+POSICIONE("ZL3",1,xFILIAL("ZL3")+SA2->A2_L_LI_RO,"ZL3_DESCRI"),oFontNormal)

If !Empty(SA2->A2_BANCO) 
	nL += 50
	oReport:Say(nL,_nPos1,"BANCO: ",oFontRotulo)
	oReport:Say(nL,_nPos2,SA2->A2_BANCO,oFontNormal)
	oReport:Say(nL,_nPos5,"AGENCIA: ",oFontRotulo)
	oReport:Say(nL,_nPos5+250,SA2->A2_AGENCIA,oFontNormal)
	oReport:Say(nL,_nPos3,"CONTA: ",oFontRotulo)
	oReport:Say(nL,_nPos4,SA2->A2_NUMCON,oFontNormal)
EndIf


nL += 80
oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
nL += 50
oReport:Say(nL,1000,"DEMONSTRATIVO ",oFontTitulo) 
nL += 50
oReport:FillRect({nL,2300,nL+1,100},TBrush():New("",0))
nL += 50

Return

/*
ÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜÜ
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
±±ÉÍÍÍÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍËÍÍÍÍÍÍÑÍÍÍÍÍÍÍÍÍÍÍÍÍ»±±
±±ºPrograma  ³ ValidPergº Autor ³ Microsiga          º Data ³  00/00/00   º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÊÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºDesc.     ³                                                            º±±
±±º          ³                                                            º±±
±±ÌÍÍÍÍÍÍÍÍÍÍØÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¹±±
±±ºUso       ³                                                            º±±
±±ÈÍÍÍÍÍÍÍÍÍÍÏÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍÍ¼±±
±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±±
ßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßßß
*/
Static function ValidPerg()

Local aHelpPor := {}
Local aHelpEng := {}
Local aHelpSpa := {}

//Do Mix
aHelpPor := {}
Aadd( aHelpPor, 'Informe o codigo do Mix.   ')
Aadd( aHelpPor, '.                      ')
U_xPutSx1(cPerg,"01","Do Mix"," "," ","mv_ch1","C",6,0,0,"G","","ZLE_01","","","MV_PAR01","","","","","","","","","","","","","","","","",aHelpPor,aHelpEng,aHelpSpa)

//Do Produtor
aHelpPor := {}
Aadd( aHelpPor, 'Informe o codigo inicial do carreteiro')
Aadd( aHelpPor, 'que deseja filtrar.                 ')
U_xPutSx1(cPerg,"02","Do Carreteiro"," "," ","mv_ch2","C",6,0,0,"G","","SA2_L1","","","MV_PAR02","","","","","","","","","","","","","","","","",aHelpPor,aHelpEng,aHelpSpa)

//Ate Produtor
aHelpPor := {}
Aadd( aHelpPor, 'Informe o codigo final do produtor')
Aadd( aHelpPor, 'que deseja filtrar.               ')
U_xPutSx1(cPerg,"03","Ate Carreteiro"," "," ","mv_ch3","C",6,0,0,"G","","SA2_L1","","","MV_PAR03","","","","","","","","","","","","","","","","",aHelpPor,aHelpEng,aHelpSpa)

Return

